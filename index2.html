

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subtítulos en Tiempo Real</title>
    <style>
        body {
            background-color: transparent;
            font-family: Arial, sans-serif;
            color: white;
            font-size: 32px;
            text-align: center;
            padding: 20px;
        }
        #translatedText {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <p id="translatedText">Esperando audio...</p>

    <script>
        async function getAudioDevice() {
            const devices = await navigator.mediaDevices.enumerateDevices();
            const audioInput = devices.find(device => device.label.includes("CABLE Output"));
            return audioInput ? audioInput.deviceId : null;
        }

        async function translateText(text) {
            const url = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=es|pt`;
            try {
                const response = await fetch(url);
                const data = await response.json();
                return data.responseData.translatedText;
            } catch (error) {
                console.error("Error en la traducción:", error);
                return "Error en la traducción";
            }
        }

        async function startAudioCapture() {
            const deviceId = await getAudioDevice();
            if (!deviceId) {
                console.error("No se encontró el dispositivo de audio CABLE Output.");
                document.getElementById("translatedText").textContent = "Error: No se encontró el audio.";
                return;
            }

            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    audio: { deviceId: deviceId },
                    video: false
                });

                const audioContext = new AudioContext();
                const source = audioContext.createMediaStreamSource(stream);
                const recognizer = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
                recognizer.lang = "es-ES"; 
                recognizer.interimResults = false;
                recognizer.continuous = true;

                recognizer.onresult = async (event) => {
                    const transcript = event.results[event.results.length - 1][0].transcript;
                    console.log("Texto detectado:", transcript);
                    document.getElementById("translatedText").textContent = "Traduciendo...";
                    
                    const translatedText = await translateText(transcript);
                    document.getElementById("translatedText").textContent = translatedText;
                };

                recognizer.onerror = (event) => {
                    console.error("Error de reconocimiento de voz:", event.error);
                };

                recognizer.start();
            } catch (error) {
                console.error("Error al capturar audio:", error);
            }
        }

        startAudioCapture();
    </script>
</body>
</html>
